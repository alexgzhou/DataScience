# 健康体检数据周报20180405--smote算法调整样本比例

## df6N利用smote处理结果
### df6N数据尝试（原始数据正样本占7.6%）
>
| 0 | 1 |   
| -------------|-------------|
| 74425 | 6182 |

* perc.over = 100, perc.under = 1200；正样本14%；nrounds=400，eta = 0.3，nrounds.best=317，auc=0.9384。
>
| 0 | 1 |
| -------------|-------------|
| 74184 | 12364 |

* perc.over = 500, perc.under = 120；正样本50%；nrounds=400，eta = 0.3，nrounds.best=390，auc=0.98。发现测试集随着迭代次数增加有小幅增减。
>
| 0 | 1 |
| -------------|-------------|
| 37092 | 37092 |

### df6N数据最佳处理
* 将比例调至阳性样本占33.9%。参考：上海交通大学宁光院士及其团队在The Journal of Clinical Endocrinology & Metabolism杂志上发布了一项研究结果：中国18岁以上的成人中，代谢综合征患病率为33.9%。

* perc.over = 500, perc.under = 234；正样本33.89%；nrounds=400，eta = 0.3，nrounds.best=153，auc=97.93。
>
| 0 | 1 |
| -------------|-------------|
| 72329 | 37092 |

* 其他情况记录：nrounds=300，eta = 0.3，nrounds.best=86，auc=96.67；set.seed(1212)，nrounds=300，eta = 0.3，nrounds.best=223，auc=98.08。


## df6利用smote处理结果
### df6数据尝试（原始数据正样本占17.75%）
>
| 0 | 1 |
| -------------|-------------|
| 79511 | 17160 |

### df6数据最佳处理
* 将比例调至阳性样本占33.9%。应该两者比例会不一样。后面再找其他资料。

* perc.over = 100, perc.under = 390；正样本33.89%；set.seed(1212)，nrounds=300，eta = 0.3，nrounds.best=300，可取150，auc=96.58。
>
| 0 | 1 |
| -------------|-------------|
| 66924 | 34320 |

## 按照设想，使用第一年数据和现在的BMI预测当下label
### df7处理（类df6全部数据，包含第二年测量指标）
* perc.over = 100, perc.under = 390；正样本33.89%；set.seed(1212)，nrounds=300，eta = 0.3，nrounds.best=275，auc=97.5（跑过99.2,98）。
* 调参：$booster："gbtree"，$gamma：0.2，$max_depth：9，$min_child_weight：1，$max_delta_step：0，$subsample：1，$colsample_bytree：1，$objective："reg:logistic"
* nrounds=300，eta = 0.3，nrounds.best=275，auc=97.779
* PPV=TP/(TP+FP)=0.9086；NPV=TN/(TN+FN)=0.93

### 特征重要性：Gain是增益，树分支的主要参考因素；cover是特征观察的相对数值；Frequence是gain的一种简单版，是在所有生成树中，特征的数量。如果去掉BMI2，BMI的Gain最大。同一年，TG最大，其次BMI。
>
| Feature | Gain | Cover | frequency |
| -------------|-------------|-------------|-------------|
| BMI2 | 0.47576489 | 0.19083920 | 0.14493949 |
| TG | 0.17324012 | 0.13265532 | 0.13311331 |
| FBG | 0.06645405 | 0.12097254 | 0.13043179 |
| XINGBIE | 0.05792124 | 0.01795261 | 0.01856436 |
| HDL | 0.05382498 | 0.09966302 | 0.12424367 |
| SBP | 0.04727091 | 0.09201723 | 0.10767327 |
| BMI | 0.04444596 | 0.17190225 | 0.14700220 |
| age | 0.04272225 | 0.09209640 | 0.10031628 |
| DBP | 0.03835559 | 0.08190142 | 0.09371562 |



